# Gazebo导入veloydne 16线雷达模型




```bash
mkdir -p ~/catkin_ws/src
cd ~/catkin_ws/src
catkin_init_workspace

sudo apt-get install ros-noetic-velodyne-simulator
git clone https://bitbucket.org/DataspeedInc/veloydne_simulator.git

catkin_make ##catkin_ws目录下
```



### 1.编译"catkin_Make"时报错[protobuf版本问题]：

```bash

/usr/include/gazebo-11/gazebo/msgs/poses_stamped.pb.h:12:2: error: #error This file was generated by a newer version of protoc which is
   12 | #error This file was generated by a newer version of protoc which is
      |  ^~~~~
/usr/include/gazebo-11/gazebo/msgs/poses_stamped.pb.h:13:2: error: #error incompatible with your Protocol Buffer headers. Please update
   13 | #error incompatible with your Protocol Buffer headers.  Please update
      |  ^~~~~
/usr/include/gazebo-11/gazebo/msgs/poses_stamped.pb.h:14:2: error: #error your headers.
   14 | #error your headers.
      |  ^~~~~
In file included from /usr/include/gazebo-11/gazebo/physics/PhysicsTypes.hh:26,
                 from /usr/include/gazebo-11/gazebo/physics/Model.hh:28,
                 from /usr/include/gazebo-11/gazebo/physics/Actor.hh:27,
                 from /usr/include/gazebo-11/gazebo/physics/physics.hh:2,
                 from /home/zonlin/catkin_ws/src/velodyne_simulator/velodyne_gazebo_plugins/include/velodyne_gazebo_plugins/GazeboRosVelodyneLaser.h:49,
                 from /home/zonlin/catkin_ws/src/velodyne_simulator/velodyne_gazebo_plugins/src/GazeboRosVelodyneLaser.cpp:35:
/usr/include/gazebo-11/gazebo/msgs/poses_stamped.pb.h:12:2: error: #error This file was generated by a newer version of protoc which is
   12 | #error This file was generated by a newer version of protoc which is
      |  ^~~~~
/usr/include/gazebo-11/gazebo/msgs/poses_stamped.pb.h:13:2: error: #error incompatible with your Protocol Buffer headers. Please update
   13 | #error incompatible with your Protocol Buffer headers.  Please update
      |  ^~~~~
/usr/include/gazebo-11/gazebo/msgs/poses_stamped.pb.h:14:2: error: #error your headers.
   14 | #error your headers.
      |  ^~~~~
In file included from /usr/include/gazebo-11/gazebo/msgs/poses_stamped.pb.h:33,
                 from /usr/include/gazebo-11/gazebo/physics/PhysicsTypes.hh:26,
                 from /usr/include/gazebo-11/gazebo/physics/Model.hh:28,
                 from /usr/include/gazebo-11/gazebo/physics/Actor.hh:27,
                 from /usr/include/gazebo-11/gazebo/physics/physics.hh:2,
                 from /home/zonlin/catkin_ws/src/velodyne_simulator/velodyne_gazebo_plugins/include/velodyne_gazebo_plugins/GazeboRosVelodyneLaser.h:49,
                 from /home/zonlin/catkin_ws/src/velodyne_simulator/velodyne_gazebo_plugins/src/GazeboRosVelodyneLaser.cpp:35:
/usr/include/gazebo-11/gazebo/msgs/time.pb.h:12:2: error: #error This file was generated by a newer version of protoc which is
   12 | #error This file was generated by a newer version of protoc which is
      |  ^~~~~
In file included from /usr/include/gazebo-11/gazebo/msgs/poses_stamped.pb.h:33,
                 from /usr/include/gazebo-11/gazebo/physics/PhysicsTypes.hh:26,
                 from /usr/include/gazebo-11/gazebo/physics/Model.hh:28,
                 from /usr/include/gazebo-11/gazebo/physics/Actor.hh:27,
                 from /usr/include/gazebo-11/gazebo/physics/physics.hh:2,
                 from /home/zonlin/catkin_ws/src/velodyne_simulator/velodyne_gazebo_plugins/include/velodyne_gazebo_plugins/GazeboRosVelodyneLaser.h:49,
                 from /home/zonlin/catkin_ws/src/velodyne_simulator/velodyne_gazebo_plugins/src/GazeboRosVelodyneLaser.cpp:35:
/usr/include/gazebo-11/gazebo/msgs/time.pb.h:12:2: error: #error This file was generated by a newer version of protoc which is
   12 | #error This file was generated by a newer version of protoc which is
      |  ^~~~~
/usr/include/gazebo-11/gazebo/m编译"catkin_Make"时报错：ude/gazebo-11/gazebo/physics/PhysicsTypes.hh:26,
                 from /usr/include/gazebo-11/gazebo/physics/Model.hh:28,
                 from /usr/include/gazebo-11/gazebo/physics/Actor.hh:27,
                 from /usr/include/gazebo-11/gazebo/physics/physics.hh:2,
                 from /home/zonlin/catkin_ws/src/velodyne_simulator/velodyne_gazebo_plugins/include/velodyne_gazebo_plugins/GazeboRosVelodyneLaser.h:49,
                 from /home/zonlin/catkin_ws/src/velodyne_simulator/velodyne_gazebo_plugins/src/GazeboRosVelodyneLaser.cpp:35:
/usr/include/gazebo-11/gazebo/msgs/pose.pb.h:12:2: error: #error This file was generated by a newer version of protoc which is
   12 | #error This file was generated by a newer version of protoc which is
      |  ^~~~~编译
/usr/include/gazebo-11/gazebo/msgs/pose.pb.h:14:2: error: #error your headers.
   14 | #error your headers.
      |  ^~~~~
/usr/include/gazebo-11/gazebo/msgs/pose.pb.h:13:2: error: #error incompatible with your Protocol Buffer headers. Please update
   13 | #error incompatible with your Protocol Buffer headers.  Please update
      |  ^~~~~
/usr/include/gazebo-11/gazebo/msgs/pose.pb.h:14:2: error: #error your headers.
   14 | #error your headers.
      |  ^~~~~
In file included from /usr/include/gazebo-11/gazebo/msgs/pose.pb.h:33,
                 from /usr/include/gazebo-11/gazebo/msgs/poses_stamped.pb.h:34,
                 from /usr/include/gazebo-11/gazebo/physics/PhysicsTypes.hh:26,
                 from /usr/include/gazebo-11/gazebo/physics/Model.hh:28,
                 from /usr/include/gazebo-11/gazebo/physics/Actor.hh:27,
                 from /usr/include/gazebo-11/gazebo/physics/physics.hh:2,
                 from /home/zonlin/catkin_ws/src/velodyne_simulator/velodyne_gazebo_plugins/include/velodyne_gazebo_plugins/GazeboRosVelodyneLaser.h:49,
                 from /home/zonlin/catkin_ws/src/velodyne_simulator/velodyne_gazebo_plugins/src/GazeboRosVelodyneLaser.cpp:35:
/usr/include/gazebo-11/gazebo/msgs/vector3d.pb.h:12:2: error: #error This file was generated by a newer version of protoc which is
   12 | #error This file was generated by a newer version of protoc which is
      |  ^~~~~
/usr/include/gazebo-11/gazebo/msgs/vector3d.pb.h:13:2: error: #error incompatible with your Protocol Buffer headers. Please update
   13 | #error incompatible with your Protocol Buffer headers.  Please update
      |  ^~~~~
/usr/include/gazebo-11/gazebo/msgs/vector3d.pb.h:14:2: error: #error your headers.
   14 | #error your headers.
      |  ^~~~~
In file included from /usr/include/gazebo-11/gazebo/msgs/pose.pb.h:33,
                 from /usr/include/gazebo-11/gazebo/msgs/poses_stamped.pb.h:34,
                 from /usr/include/gazebo-11/gazebo/physics/PhysicsTypes.hh:26,
                 from /usr/include/gazebo-11/gazebo/physics/Model.hh:28,
                 from /usr/include/gazebo-11/gazebo/physics/Actor.hh:27,
                 from /usr/include/gazebo-11/gazebo/physics/physics.hh:2,
                 from /home/zonlin/catkin_ws/src/velodyne_simulator/velodyne_gazebo_plugins/include/velodyne_gazebo_plugins/GazeboRosVelodyneLaser.h:49,
                 from /home/zonlin/catkin_ws/src/velodyne_simulator/velodyne_gazebo_plugins/src/GazeboRosVelodyneLaser.cpp:35:
/usr/include/gazebo-11/gazebo/msgs/vector3d.pb.h:12:2: error: #error This file was generated by a newer version of protoc which is
   12 | #error This file was generated by a newer version of protoc which is
      |  ^~~~~
/usr/include/gazebo-11/gazebo/msgs/vector3d.pb.h:13:2: error: #error incompatible with your Protocol Buffer headers. Please update
   13 | #error incompatible with your Protocol Buffer headers.  Please update
      |  ^~~~~
/usr/include/gazebo-11/gazebo/msgs/vector3d.pb.h:14:2: error: #error your headers.
   14 | #error your headers.
      |  ^~~~~
In file included from /usr/include/gazebo-11/gazebo/msgs/pose.pb.h:34,
                 from /usr/include/gazebo-11/gazebo/msgs/poses_stamped.pb.h:34,
                 from /usr/include/gazebo-11/gazebo/physics/PhysicsTypes.hh:26,
                 from /usr/include/gazebo-11/gazebo/physics/Model.hh:28,
                 from /usr/include/gazebo-11/gazebo/physics/Actor.hh:27,
                 from /usr/include/gazebo-11/gazebo/physics/physics.hh:2,
                 from /home/zonlin/catkin_ws/src/velodyne_simulator/velodyne_gazebo_plugins/include/velodyne_gazebo_plugins/GazeboRosVelodyneLaser.h:49,
                 from /home/zonlin/catkin_ws/src/velodyne_simulator/velodyne_gazebo_plugins/src/GazeboRosVelodyneLaser.cpp:35:
/usr/include/gazebo-11/gazebo/msgs/quaternion.pb.h:12:2: error: #error This file was generated by a newer version of protoc which is
   12 | #error This file was generated by a newer version of protoc which is
      |  ^~~~~
In file included from /usr/include/gazebo-11/gazebo/msgs/pose.pb.h:34,
                 from /usr/include/gazebo-11/gazebo/msgs/poses_stamped.pb.h:34,
                 from /usr/include/gazebo-11/gazebo/physics/PhysicsTypes.hh:26,
                 from /usr/include/gazebo-11/gazebo/physics/Model.hh:28,
                 from /usr/include/gazebo-11/gazebo/physics/Actor.hh:27,
                 from /usr/include/gazebo-11/gazebo/physics/physics.hh:2,
                 from /home/zonlin/catkin_ws/src/velodyne_simulator/velodyne_gazebo_plugins/include/velodyne_gazebo_plugins/GazeboRosVelodyneLaser.h:49,
                 from /home/zonlin/catkin_ws/src/velodyne_simulator/velodyne_gazebo_plugins/src/GazeboRosVelodyneLaser.cpp:35:
/usr/include/gazebo-11/gazebo/msgs/quaternion.pb.h:12:2: error: #error This file was generated by a newer version of protoc which is
   12 | #error This file was generated by a newer version of protoc which is
      |  ^~~~~
/usr/include/gazebo-11/gazebo/msgs/quaternion.pb.h:13:2: error: #error incompatible with your Protocol Buffer headers. Please update
   13 | #error incompatible with your Protocol Buffer headers.  Please update
      |  ^~~~~
/usr/include/gazebo-11/gazebo/msgs/quaternion.pb.h:14:2: error: #error your headers.
   14 | #error your headers.
      |  ^~~~~
/usr/include/gazebo-11/gazebo/msgs/quaternion.pb.h:13:2: error: #error incompatible with your Protocol Buffer headers. Please update
   13 | #error incompatible with your Protocol Buffer headers.  Please update
      |  ^~~~~
/usr/include/gazebo-11/gazebo/msgs/quaternion.pb.h:14:2: error: #error your headers.
   14 | #error your headers.
      |  ^~~~~
........

```

打开其中一个错误文件(/usr/include/gazebo-11/gazebo/msgs/quaternion.pb.h)前20行: //

```c++

// Generated by the protocol buffer compiler.  DO NOT EDIT!
// source: vector3d.proto

#ifndef PROTOBUF_INCLUDED_vector3d_2eproto
#define PROTOBUF_INCLUDED_vector3d_2eproto

#include <string>

#include <google/protobuf/stubs/common.h>

#if GOOGLE_PROTOBUF_VERSION < 3006001
#error This file was generated by a newer version of protoc which is
#error incompatible with your Protocol Buffer headers.  Please update
#error your headers.
#endif
#if 3006001 < GOOGLE_PROTOBUF_MIN_PROTOC_VERSION
#error This file was generated by an older version of protoc which is
#error incompatible with your Protocol Buffer headers.  Please
#error regenerate this file with a newer version of protoc.
#endif

```

根据报错信息：This file was generated by a newer version of protoc which is incompatible with your Protocol Buffer headers.  Please update your headers. (注意断句。。。)得知原因为第一个if语句，GOOGLE_PROTOBUF版本低于3.6.1，解决办法为升高版本。

查看现有版本（系统当前识别的版本）位置：

```bash

zonlin@zonlin3590:~/catkin_ws$ which protoc
/usr/local/bin/protoc
zonlin@zonlin3590:~/catkin_ws$ protoc --version
libprotoc 3.4.0

```

将现有protoc版本删除：

```bash

root@zonlin3590:/home/zonlin/catkin_ws# rm /usr/local/bin/protoc
root@zonlin3590:/home/zonlin/catkin_ws# which protoc
/usr/bin/protoc
root@zonlin3590:/home/zonlin/catkin_ws# protoc --version
libprotoc 3.6.1

```

protobuf版本自动回到3.6.1（应该是ros自带版本)。若无protobuf，则手动安装编译protobuf3.6.1。

### 2.编译"catkin_Make"时报错[‘CreateMaybeMessage’未声明]：

```bash

/usr/include/ignition/msgs5/ignition/msgs/actor.pb.h: In member function ‘virtual ignition::msgs::Actor_Waypoint* ignition::msgs::Actor_Waypoint::New() const’:
/usr/include/ignition/msgs5/ignition/msgs/actor.pb.h:276:12: error: ‘CreateMaybeMessage’ was not declared in this scope
  276 |     return CreateMaybeMessage<Actor_Waypoint>(NULL);
      |            ^~~~~~~~~~~~~~~~~~
/usr/include/ignition/msgs5/ignition/msgs/actor.pb.h:276:45: error: expected primary-expression before ‘>’ token
  276 |     return CreateMaybeMessage<Actor_Waypoint>(NULL);
      |                                             ^
/usr/include/ignition/msgs5/ignition/msgs/actor.pb.h: In member function ‘virtual ignition::msgs::Actor_Waypoint* ignition::msgs::Actor_Waypoint::New() const’:
/usr/include/ignition/msgs5/ignition/msgs/actor.pb.h:276:12: error: ‘CreateMaybeMessage’ was not declared in this scope
  276 |     return CreateMaybeMessage<Actor_Waypoint>(NULL);
      |            ^~~~~~~~~~~~~~~~~~
/usr/include/ignition/msgs5/ignition/msgs/actor.pb.h:276:45: error: expected primary-expression before ‘>’ token
  276 |     return CreateMaybeMessage<Actor_Waypoint>(NULL);
      |                                             ^
/usr/include/ignition/msgs5/ignition/msgs/actor.pb.h: In member function ‘virtual ignition::msgs::Actor_Waypoint* ignition::msgs::Actor_Waypoint::New(google::protobuf::Arena*) const’:
/usr/include/ignition/msgs5/ignition/msgs/actor.pb.h:280:12: error: ‘CreateMaybeMessage’ was not declared in this scope
  280 |     return CreateMaybeMessage<Actor_Waypoint>(arena);
      |            ^~~~~~~~~~~~~~~~~~
/usr/include/ignition/msgs5/ignition/msgs/actor.pb.h:280:45: error: expected primary-expression before ‘>’ token
  280 |     return CreateMaybeMessage<Actor_Waypoint>(arena);
      |                                             ^
/usr/include/ignition/msgs5/ignition/msgs/actor.pb.h: In member function ‘virtual ignition::msgs::Actor_Waypoint* ignition::msgs::Actor_Waypoint::New(google::protobuf::Arena*) const’:
/usr/include/ignition/msgs5/ignition/msgs/actor.pb.h:280:12: error: ‘CreateMaybeMessage’ was not declared in this scope
  280 |     return CreateMaybeMessage<Actor_Waypoint>(arena);
      |            ^~~~~~~~~~~~~~~~~~
......

```

报错：‘CreateMaybeMessage’ was not declared in this scope，推测原因仍然是缺少某些文件。查阅资料发现其与potobuf有关，因此解决办法：手动下载编译protobuf3.6.1（地址https://github.com/protocolbuffers/protobuf/releases)，找到3.6.1版本发布页，下载protobuf-all-3.6.1.tar.gz。

```bash

tar zvxf protobuf-all-3.6.1.tar.gz
cd protobuf-3.6.1

./configure -prefix=/usr/local

sudo make
sudo make check
sudo make install
```

### 3. 

